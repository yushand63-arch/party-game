<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼€å‡ºä½ çš„æ—…è¡Œç›®çš„åœ°ï¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 95%;
            text-align: center;
        }

        h1 {
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #4a5568;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 100%);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 18px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(45deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-solo {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            padding: 25px 50px;
            font-size: 22px;
        }

        .btn-party {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            padding: 25px 50px;
            font-size: 22px;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 18px;
            margin: 15px 0;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .mode-card {
            background: #f7fafc;
            border-radius: 20px;
            padding: 30px;
            width: 300px;
            transition: transform 0.3s ease;
        }

        .mode-card:hover {
            transform: translateY(-5px);
        }

        .mode-card h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .mode-card p {
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
        }

        .level-badge {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .mystery-box {
            background: linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .mystery-box:hover {
            transform: scale(1.02);
        }

        .mystery-box::before {
            content: 'ğŸ';
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
        }

        .clue-area {
            background: #f7fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 120px;
            border: 2px dashed #cbd5e0;
        }

        .clue-content {
            font-size: 18px;
            line-height: 1.6;
            color: #4a5568;
        }

        /* æç¤ºè¯ç›’å­æ ·å¼ */
        .clue-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 35px;
            border-radius: 15px;
            font-size: 28px;
            font-weight: bold;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.5s ease;
        }
        
        .clue-box.revealed {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
            animation: popIn 0.5s ease;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .hints-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .hint-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 22px;
            font-weight: bold;
            color: #4a5568;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            min-width: 150px;
            text-align: center;
        }

        .hint-card:nth-child(1) {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .hint-card:nth-child(2) {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .hint-card:nth-child(3) {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }

        /* å•äººé—¯å…³ç»“æœæ ·å¼ */
        .solo-result {
            padding: 30px;
        }

        .level-result {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-item h4 {
            color: #718096;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-item p {
            color: #4a5568;
            font-size: 28px;
            font-weight: bold;
        }

        .level-stars {
            font-size: 40px;
            margin: 20px 0;
        }

        /* ç­”æ¡ˆæ­æ™“æ ·å¼ */
        .answer-reveal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin: 20px 0;
        }

        .answer-reveal h2 {
            color: white;
            font-size: 48px;
            margin-bottom: 15px;
        }

        .answer-reveal p {
            font-size: 18px;
            opacity: 0.9;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti 3s linear infinite;
        }

        .confetti:nth-child(2n) { background: #4ecdc4; }
        .confetti:nth-child(3n) { background: #45b7d1; }
        .confetti:nth-child(4n) { background: #f9ca24; }
        .confetti:nth-child(5n) { background: #6c5ce7; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                width: 98%;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .mode-selection {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-card {
                width: 100%;
            }
            
            .quiz-header {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .hint-card, .clue-box {
                min-width: 100px;
                padding: 15px 20px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨¡å¼é€‰æ‹©é¡µ -->
        <div id="modePage" class="page active">
            <h1>ğŸ å¼€å‡ºä½ çš„æ—…è¡Œç›®çš„åœ°ï¼</h1>
            <p style="color: #718096; margin-bottom: 20px;">é€‰æ‹©ä½ çš„æ¸¸æˆæ¨¡å¼</p>
            <div class="mode-selection">
                <div class="mode-card">
                    <h3>ğŸ¯ å•äººé—¯å…³ç‰ˆ</h3>
                    <p>ç‹¬è‡ªæŒ‘æˆ˜ä¸‰å…³<br>éš¾åº¦é€æ­¥é€’è¿›<br>çœ‹çœ‹ä½ èƒ½é—¯åˆ°ç¬¬å‡ å…³ï¼</p>
                    <button class="btn btn-solo" onclick="selectMode('solo')">å¼€å§‹é—¯å…³</button>
                </div>
                <div class="mode-card">
                    <h3>ğŸ‰ å¤šäººæ´¾å¯¹ç‰ˆ</h3>
                    <p>æç¤ºè¯æ¯15ç§’æ­æ™“ä¸€ä¸ª<br>å¤§å®¶ä¸€èµ·çŒœåœ°å<br>çœ‹è°æœ€å…ˆçŒœä¸­ï¼</p>
                    <button class="btn btn-party" onclick="selectMode('party')">å¼€å§‹æ´¾å¯¹</button>
                </div>
            </div>
        </div>

        <!-- å•äººé—¯å…³ï¼šè¾“å…¥æ˜µç§° -->
        <div id="soloLoginPage" class="page">
            <h1>ğŸ¯ å•äººé—¯å…³æ¨¡å¼</h1>
            <p style="color: #718096; margin-bottom: 20px;">ä¸‰å…³æŒ‘æˆ˜ï¼Œéš¾åº¦é€’è¿›ï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼Ÿ</p>
            <div class="level-result" style="background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); color: white;">
                <p>ğŸŒŸ ç¬¬ä¸€å…³ï¼šå…¥é—¨çº§ï¼ˆ5é¢˜ï¼‰- çƒ­é—¨åŸå¸‚</p>
                <p>ğŸŒŸğŸŒŸ ç¬¬äºŒå…³ï¼šè¿›é˜¶çº§ï¼ˆ5é¢˜ï¼‰- ç‰¹è‰²åŸå¸‚</p>
                <p>ğŸŒŸğŸŒŸğŸŒŸ ç¬¬ä¸‰å…³ï¼šåœ°ç‹±çº§ï¼ˆ5é¢˜ï¼‰- å†·é—¨å®è—</p>
            </div>
            <input type="text" id="soloPlayerName" class="input-field" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" maxlength="10">
            <br>
            <button class="btn btn-primary" onclick="startSoloGame()">ğŸš€ å¼€å§‹æŒ‘æˆ˜</button>
            <button class="btn btn-warning" onclick="backToMode()">ğŸ”™ è¿”å›</button>
        </div>

        <!-- å¤šäººæ´¾å¯¹ï¼šç­”é¢˜é¡µé¢ -->
        <div id="partyQuizPage" class="page">
            <div class="quiz-header">
                <h2 id="partyQuestionNumber">ç¬¬ 1/10 é¢˜</h2>
                <div class="timer" id="partyTimer">â° 45ç§’</div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="partyProgressFill" style="width: 10%"></div>
            </div>

            <div class="clue-area">
                <h3 style="margin-bottom: 20px;">ğŸ” æç¤ºè¯ï¼ˆæ¯15ç§’æ­æ™“ä¸€ä¸ªï¼‰</h3>
                <div id="partyClues" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <div class="clue-box" id="clue1">â“</div>
                    <div class="clue-box" id="clue2">â“</div>
                    <div class="clue-box" id="clue3">â“</div>
                </div>
                <p id="clueHint" style="margin-top: 20px; color: #667eea; font-size: 18px;">ç¬¬ä¸€ä¸ªæç¤ºè¯å³å°†æ­æ™“...</p>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn btn-success" onclick="someoneGuessed()" style="font-size: 22px; padding: 20px 40px;">âœ… æœ‰äººçŒœå¯¹äº†ï¼</button>
                <button class="btn btn-warning" onclick="showPartyAnswer()" style="font-size: 18px;">ğŸ³ï¸ æ­æ™“ç­”æ¡ˆ</button>
            </div>
            
            <button class="btn" onclick="backToMode()" style="margin-top: 20px; background: #a0aec0;">ğŸ  è¿”å›é¦–é¡µ</button>
        </div>

        <!-- å¤šäººæ´¾å¯¹ï¼šç­”æ¡ˆæ­æ™“ -->
        <div id="partyAnswerPage" class="page">
            <h1>ğŸ‰ ç­”æ¡ˆæ­æ™“ï¼</h1>
            <div class="answer-reveal">
                <h2 id="partyAnswerCity">???</h2>
                <p id="partyAnswerDesc">ç›®çš„åœ°æè¿°</p>
            </div>
            <div style="margin: 30px 0;">
                <p style="font-size: 20px; color: #4a5568;" id="partyResultText">å‡†å¤‡å¥½ä¸‹ä¸€é¢˜äº†å—ï¼Ÿ</p>
            </div>
            <button class="btn btn-primary" onclick="nextPartyQuestion()" style="font-size: 20px; padding: 18px 40px;">â¡ï¸ ä¸‹ä¸€é¢˜</button>
        </div>

        <!-- å¤šäººæ´¾å¯¹ï¼šæ¸¸æˆç»“æŸ -->
        <div id="partyEndPage" class="page">
            <h1>ğŸ† æ¸¸æˆç»“æŸï¼</h1>
            <div class="level-result">
                <h3 style="font-size: 28px; margin-bottom: 20px;">æ„Ÿè°¢å‚ä¸ï¼</h3>
                <p style="font-size: 20px;">å…±å®Œæˆ <span id="partyTotalQuestions">10</span> é“é¢˜ç›®</p>
                <p style="font-size: 18px; margin-top: 15px; color: #667eea;">å¸Œæœ›å¤§å®¶ç©å¾—å¼€å¿ƒï¼ğŸŠ</p>
            </div>
            <button class="btn btn-primary" onclick="restartPartyGame()" style="font-size: 20px;">ğŸ”„ å†ç©ä¸€å±€</button>
            <button class="btn btn-warning" onclick="backToMode()">ğŸ  è¿”å›é¦–é¡µ</button>
        </div>

        <!-- å•äººç­”é¢˜é¡µé¢ -->
        <div id="quizPage" class="page">
            <div class="quiz-header">
                <span class="level-badge" id="levelBadge">ç¬¬ä¸€å…³</span>
                <h2 id="questionNumber">ç¬¬ 1/5 é¢˜</h2>
                <div class="timer" id="timer">â° 60ç§’</div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>

            <div class="mystery-box" id="mysteryBox" onclick="openMysteryBox()">
                <h3>ğŸ ç‚¹å‡»æŠ½å–æ—…æ¸¸ç›²ç›’</h3>
                <p>ç¥ç§˜çš„æ—…æ¸¸ç›®çš„åœ°ç­‰ä½ å‘ç°ï¼</p>
            </div>

            <div class="clue-area" id="clueArea">
                <div class="clue-content">
                    ç‚¹å‡»ä¸Šæ–¹ç›²ç›’è·å–3ä¸ªå…³é”®è¯æç¤º...
                </div>
            </div>

            <div>
                <input type="text" id="answerInput" class="input-field" placeholder="è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆ" disabled>
                <br>
                <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()" disabled>âœ… æäº¤ç­”æ¡ˆ</button>
            </div>
        </div>

        <!-- å•äººé—¯å…³ï¼šå…³å¡ç»“ç®—é¡µ -->
        <div id="soloLevelResultPage" class="page">
            <div class="solo-result">
                <h1 id="levelResultTitle">ğŸ‰ ç¬¬ä¸€å…³å®Œæˆï¼</h1>
                <div class="level-result">
                    <div class="level-stars" id="levelStars">â­â­â­</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <h4>æ­£ç¡®é¢˜æ•°</h4>
                            <p id="levelCorrect">4/5</p>
                        </div>
                        <div class="stat-item">
                            <h4>æ­£ç¡®ç‡</h4>
                            <p id="levelAccuracy">80%</p>
                        </div>
                        <div class="stat-item">
                            <h4>ç”¨æ—¶</h4>
                            <p id="levelTime">45.2ç§’</p>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success pulse" id="nextLevelBtn" onclick="nextLevel()">ğŸš€ è¿›å…¥ä¸‹ä¸€å…³</button>
                <button class="btn btn-warning" onclick="resetGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <!-- å•äººé—¯å…³ï¼šæœ€ç»ˆç»“ç®—é¡µ -->
        <div id="soloFinalResultPage" class="page">
            <h1>ğŸ† é—¯å…³å®Œæˆï¼</h1>
            <div class="level-result">
                <h3 id="finalTitle">æ­å–œé€šå…³ï¼</h3>
                <div class="level-stars" id="finalStars">â­â­â­â­â­</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <h4>æ€»æ­£ç¡®æ•°</h4>
                        <p id="finalCorrect">12/15</p>
                    </div>
                    <div class="stat-item">
                        <h4>æ€»æ­£ç¡®ç‡</h4>
                        <p id="finalAccuracy">80%</p>
                    </div>
                    <div class="stat-item">
                        <h4>æ€»ç”¨æ—¶</h4>
                        <p id="finalTime">120.5ç§’</p>
                    </div>
                </div>
            </div>
            <button class="btn btn-success" onclick="resetGame()">ğŸ® å†æ¥ä¸€æ¬¡</button>
            <button class="btn btn-primary" onclick="backToMode()">ğŸ”™ è¿”å›é¦–é¡µ</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ¨¡å¼
        let gameMode = '';

        // å•äººæ¨¡å¼çŠ¶æ€
        let gameState = {
            currentPlayer: null,
            currentQuestion: 0,
            currentLevel: 1,
            timer: null,
            timeLeft: 60,
            questionStartTime: 0,
            levelResults: []
        };

        // å¤šäººæ´¾å¯¹æ¨¡å¼çŠ¶æ€
        let partyQuestions = [];
        let partyCurrentQuestion = 0;
        let partyRevealedClues = 0;
        let partyTimer = null;
        let partyClueTimer = null;
        let partyTimeLeft = 45;
        let partyTotalQuestions = 10;

        // å•äººé¢˜åº“
        const soloQuestionBank = {
            level1: [
                { hints: ["ğŸ¯ æ•…å®«é•¿åŸ", "ğŸ¦† çƒ¤é¸­", "ğŸ›ï¸ å¤©å®‰é—¨"], answer: "åŒ—äº¬", keywords: ["åŒ—äº¬"] },
                { hints: ["ğŸŒƒ é­”éƒ½", "ğŸ¥Ÿ ç”Ÿç…å°ç¬¼", "ğŸ—¼ ä¸œæ–¹æ˜ç "], answer: "ä¸Šæµ·", keywords: ["ä¸Šæµ·"] },
                { hints: ["ğŸŒ¶ï¸ 8Dé­”å¹»", "ğŸ² ä¹å®«æ ¼ç«é”…", "ğŸš¡ è½»è½¨ç©¿æ¥¼"], answer: "é‡åº†", keywords: ["é‡åº†"] },
                { hints: ["ğŸ¼ æ¥äº†ä¸æƒ³èµ°", "ğŸŒ¶ï¸ ä¸²ä¸²é¦™", "ğŸ® å®½çª„å··å­"], answer: "æˆéƒ½", keywords: ["æˆéƒ½"] },
                { hints: ["ğŸµ äººé—´å¤©å ‚", "ğŸœ ç‰‡å„¿å·", "ğŸï¸ è¥¿æ¹–"], answer: "æ­å·", keywords: ["æ­å·"] },
                { hints: ["ğŸ­ åä¸‰æœå¤éƒ½", "ğŸœ è‚‰å¤¹é¦", "âš”ï¸ å…µé©¬ä¿‘"], answer: "è¥¿å®‰", keywords: ["è¥¿å®‰"] },
                { hints: ["ğŸ¥˜ å¹æ—©èŒ¶", "ğŸŒƒ å°è›®è…°", "ğŸŒŠ ç æ±Ÿ"], answer: "å¹¿å·", keywords: ["å¹¿å·"] },
                { hints: ["ğŸ¹ é’¢ç´ä¹‹å²›", "ğŸœ æ²™èŒ¶é¢", "ğŸï¸ é¼“æµªå±¿"], answer: "å¦é—¨", keywords: ["å¦é—¨"] }
            ],
            level2: [
                { hints: ["ğŸ“¸ 20å…ƒäººæ°‘å¸èƒŒæ™¯", "ğŸœ å—¦ç²‰", "ğŸï¸ æ¼“æ±Ÿç«¹ç­"], answer: "æ¡‚æ—", keywords: ["æ¡‚æ—"] },
                { hints: ["ğŸ´ èŒ¶é©¬å¤é“", "ğŸ«• è…Šæ’éª¨ç«é”…", "ğŸ”ï¸ ç‰é¾™é›ªå±±"], answer: "ä¸½æ±Ÿ", keywords: ["ä¸½æ±Ÿ"] },
                { hints: ["ğŸº å“ˆå•¤é…’åƒå˜å•¦", "ğŸ¦ è¾£ç‚’è›¤èœŠ", "ğŸŒ‰ æ ˆæ¡¥"], answer: "é’å²›", keywords: ["é’å²›"] },
                { hints: ["ğŸ“œ è½éœä¸å­¤é¹œé½é£", "ğŸ² ç“¦ç½æ±¤æ‹Œç²‰", "ğŸ¯ æ»•ç‹é˜"], answer: "å—æ˜Œ", keywords: ["å—æ˜Œ"] },
                { hints: ["ğŸŒ¸ çƒŸèŠ±ä¸‰æœˆ", "ğŸ¥Ÿ èŸ¹é»„æ±¤åŒ…", "ğŸ‹ ç˜¦è¥¿æ¹–"], answer: "æ‰¬å·", keywords: ["æ‰¬å·"] },
                { hints: ["ğŸ¦† é¸­é¸­æˆ‘å•Š", "ğŸœ é¸­è¡€ç²‰ä¸æ±¤", "ğŸ›ï¸ ä¸­å±±é™µ"], answer: "å—äº¬", keywords: ["å—äº¬"] },
                { hints: ["ğŸ™ ä¸€ç”Ÿå¿…å»ä¸€æ¬¡", "ğŸ«– é…¥æ²¹èŒ¶ç³Œç²‘", "ğŸ° å¸ƒè¾¾æ‹‰å®«"], answer: "æ‹‰è¨", keywords: ["æ‹‰è¨"] },
                { hints: ["ğŸ¨ é£å¤©å£ç”»", "ğŸ– é©´è‚‰é»„é¢", "ğŸŒ™ æœˆç‰™æ³‰"], answer: "æ•¦ç…Œ", keywords: ["æ•¦ç…Œ"] }
            ],
            level3: [
                { hints: ["ğŸŒˆ å½©è™¹å±±ä¸¹éœ", "ğŸœ ç‰›å¤§ç¢—", "ğŸŒ‰ é»„æ²³é“æ¡¥"], answer: "å…°å·", keywords: ["å…°å·"] },
                { hints: ["ğŸ é£å¹è‰ä½", "ğŸ¥› å¥¶èŒ¶æ‰‹æ‰’è‚‰", "ğŸœï¸ å“æ²™æ¹¾"], answer: "å‘¼å’Œæµ©ç‰¹", keywords: ["å‘¼å’Œæµ©ç‰¹", "å‘¼å¸‚"] },
                { hints: ["ğŸŒ¾ å¡ä¸Šæ±Ÿå—", "ğŸ‡ æ¸æ", "ğŸœï¸ æ²™å¡å¤´"], answer: "é“¶å·", keywords: ["é“¶å·"] },
                { hints: ["ğŸŒŠ å¤©ç©ºä¹‹é•œ", "ğŸ“¸ ç½‘çº¢æ‰“å¡", "ğŸ§‚ ç›æ¹–"], answer: "èŒ¶å¡", keywords: ["èŒ¶å¡"] },
                { hints: ["ğŸ¦Œ é©¯é¹¿ä¹‹ä¹¡", "â„ï¸ å†·ææ‘", "ğŸŒ² ç™½æ¡¦æ—"], answer: "æ¼ æ²³", keywords: ["æ¼ æ²³"] },
                { hints: ["ğŸ­ å˜è„¸ç»æŠ€", "ğŸµ ç›–ç¢—èŒ¶", "ğŸ» å¤§ä½›"], answer: "ä¹å±±", keywords: ["ä¹å±±"] },
                { hints: ["ğŸ‹ æ¸…æ˜ä¸Šæ²³å›¾", "ğŸ¥Ÿ çŒæ±¤åŒ…", "ğŸ›ï¸ åŒ…å…¬ç¥ "], answer: "å¼€å°", keywords: ["å¼€å°"] },
                { hints: ["ğŸº é¾™é—¨çŸ³çªŸ", "ğŸœ æ°´å¸­", "ğŸŒ¸ ç‰¡ä¸¹èŠ±åŸ"], answer: "æ´›é˜³", keywords: ["æ´›é˜³"] }
            ]
        };

        // å¤šäººæ´¾å¯¹é¢˜åº“
        const partyQuestionBank = [
            { hints: ["ğŸ“¸ 20å…ƒäººæ°‘å¸èƒŒæ™¯", "ğŸœ å—¦ç²‰", "ğŸï¸ æ¼“æ±Ÿç«¹ç­"], answer: "æ¡‚æ—" },
            { hints: ["ğŸ´ èŒ¶é©¬å¤é“", "ğŸ«• è…Šæ’éª¨ç«é”…", "ğŸ”ï¸ ç‰é¾™é›ªå±±"], answer: "ä¸½æ±Ÿ" },
            { hints: ["ğŸº å“ˆå•¤é…’åƒå˜å•¦", "ğŸ¦ è¾£ç‚’è›¤èœŠ", "ğŸŒ‰ æ ˆæ¡¥"], answer: "é’å²›" },
            { hints: ["ğŸ“œ è½éœä¸å­¤é¹œé½é£", "ğŸ² ç“¦ç½æ±¤æ‹Œç²‰", "ğŸ¯ æ»•ç‹é˜"], answer: "å—æ˜Œ" },
            { hints: ["ğŸŒ¸ çƒŸèŠ±ä¸‰æœˆ", "ğŸ¥Ÿ èŸ¹é»„æ±¤åŒ…", "ğŸ‹ ç˜¦è¥¿æ¹–"], answer: "æ‰¬å·" },
            { hints: ["ğŸ¦† é¸­é¸­æˆ‘å•Š", "ğŸœ é¸­è¡€ç²‰ä¸æ±¤", "ğŸ›ï¸ ä¸­å±±é™µ"], answer: "å—äº¬" },
            { hints: ["ğŸ™ ä¸€ç”Ÿå¿…å»ä¸€æ¬¡", "ğŸ«– é…¥æ²¹èŒ¶ç³Œç²‘", "ğŸ° å¸ƒè¾¾æ‹‰å®«"], answer: "æ‹‰è¨" },
            { hints: ["ğŸ¨ é£å¤©å£ç”»", "ğŸ– é©´è‚‰é»„é¢", "ğŸŒ™ æœˆç‰™æ³‰"], answer: "æ•¦ç…Œ" },
            { hints: ["ğŸŒ¶ï¸ 8Dé­”å¹»åŸå¸‚", "ğŸ² ä¹å®«æ ¼ç«é”…", "ğŸš¡ é•¿æ±Ÿç´¢é“"], answer: "é‡åº†" },
            { hints: ["ğŸ¼ æ¥äº†å°±ä¸æƒ³èµ°", "ğŸŒ¶ï¸ å…”å¤´å†·ä¸²ä¸²", "ğŸ® å®½çª„å··å­"], answer: "æˆéƒ½" },
            { hints: ["ğŸŒƒ é­”éƒ½", "ğŸ¥Ÿ ç”Ÿç…å°ç¬¼", "ğŸ—¼ ä¸œæ–¹æ˜ç "], answer: "ä¸Šæµ·" },
            { hints: ["ğŸ¯ å…­ç™¾å¹´ç´«ç¦åŸ", "ğŸ¦† çƒ¤é¸­å·é¥¼", "ğŸ° æ•…å®«"], answer: "åŒ—äº¬" },
            { hints: ["ğŸµ äººé—´å¤©å ‚", "ğŸœ ç‰‡å„¿å·", "ğŸï¸ è¥¿æ¹–æ–­æ¡¥"], answer: "æ­å·" },
            { hints: ["ğŸ­ åä¸‰æœå¤éƒ½", "ğŸœ è‚‰å¤¹é¦å‡‰çš®", "âš”ï¸ å…µé©¬ä¿‘"], answer: "è¥¿å®‰" },
            { hints: ["ğŸ¥˜ å¹æ—©èŒ¶", "ğŸŒƒ å°è›®è…°", "ğŸŒŠ ç æ±Ÿå¤œæ¸¸"], answer: "å¹¿å·" },
            { hints: ["ğŸ¹ é’¢ç´ä¹‹å²›", "ğŸœ æ²™èŒ¶é¢", "ğŸï¸ é¼“æµªå±¿"], answer: "å¦é—¨" },
            { hints: ["ğŸŒˆ å½©è™¹å±±", "ğŸœ ç‰›è‚‰é¢", "ğŸŒ‰ é»„æ²³é“æ¡¥"], answer: "å…°å·" },
            { hints: ["ğŸŒŠ ä¸œæ–¹å¤å¨å¤·", "ğŸ¥¥ æ¸…è¡¥å‡‰", "ğŸ–ï¸ äºšé¾™æ¹¾"], answer: "ä¸‰äºš" },
            { hints: ["ğŸµ æµªæ¼«ä¹‹éƒ½", "ğŸ¦ª çƒ¤ç”Ÿèš", "ğŸ–ï¸ æ˜Ÿæµ·å¹¿åœº"], answer: "å¤§è¿" },
            { hints: ["â„ï¸ å†°åŸ", "ğŸ– é”…åŒ…è‚‰", "â›ª ç´¢è²äºšæ•™å ‚"], answer: "å“ˆå°”æ»¨" },
            { hints: ["ğŸ”ï¸ æ˜¥åŸ", "ğŸŒ¸ è“èŠ±æ¥¹", "ğŸ¦‹ æ»‡æ± æµ·é¸¥"], answer: "æ˜†æ˜" },
            { hints: ["ğŸŒ¬ï¸ æœ‰é£çš„åœ°æ–¹", "ğŸœ é¥µä¸", "ğŸ¯ å¤åŸä¸‰å¡”"], answer: "å¤§ç†" },
            { hints: ["ğŸ—¼ é“å¡”ä¹‹åŸ", "ğŸ¥ å¯é¢‚å’–å•¡", "ğŸ¨ å¢æµ®å®«"], answer: "å·´é»" },
            { hints: ["ğŸ¡ å¤§æœ¬é’Ÿ", "â˜• ä¸‹åˆèŒ¶", "ğŸ‘‘ ç™½é‡‘æ±‰å®«"], answer: "ä¼¦æ•¦" },
            { hints: ["ğŸ›ï¸ å¤šç‘™æ²³æ˜ç ", "â™¨ï¸ æ¸©æ³‰ä¹‹éƒ½", "ğŸŒ‰ é“¾å­æ¡¥"], answer: "å¸ƒè¾¾ä½©æ–¯" },
            { hints: ["ğŸ—½ è‡ªç”±å¥³ç¥", "ğŸ å¤§è‹¹æœ", "ğŸ™ï¸ æ—¶ä»£å¹¿åœº"], answer: "çº½çº¦" },
            { hints: ["ğŸ—» å¯Œå£«å±±ä¸‹", "ğŸ£ å¯¿å¸åˆºèº«", "ğŸŒ¸ æ¨±èŠ±å¤§é“"], answer: "ä¸œäº¬" },
            { hints: ["ğŸ¦˜ æ‚‰å°¼æ­Œå‰§é™¢", "ğŸ–ï¸ é‚¦è¿ªæµ·æ»©", "ğŸŒ‰ æµ·æ¸¯å¤§æ¡¥"], answer: "æ‚‰å°¼" },
            { hints: ["ğŸ­ æ–—å…½åœº", "ğŸ æ„é¢æŠ«è¨", "â›² è®¸æ„¿æ± "], answer: "ç½—é©¬" },
            { hints: ["ğŸ’ƒ å¼—æ‹‰é—¨æˆˆ", "ğŸŸï¸ é«˜è¿ªå»ºç­‘", "âš½ è¯ºåæ™®"], answer: "å·´å¡ç½—é‚£" },
            { hints: ["ğŸº å•¤é…’èŠ‚", "ğŸ° æ–°å¤©é¹…å ¡", "ğŸ¥¨ å·´ä¼åˆ©äºš"], answer: "æ…•å°¼é»‘" },
            { hints: ["ğŸŒ· éƒé‡‘é¦™", "ğŸš² è¿æ²³éª‘è¡Œ", "ğŸ¨ æ¢µé«˜åšç‰©é¦†"], answer: "é˜¿å§†æ–¯ç‰¹ä¸¹" },
            { hints: ["ğŸ›• æ³°å¼æŒ‰æ‘©", "ğŸœ å†¬é˜´åŠŸ", "ğŸ›º å˜Ÿå˜Ÿè½¦"], answer: "æ›¼è°·" }
        ];

        let quizQuestions = [];

        // æ¨¡å¼é€‰æ‹©
        function selectMode(mode) {
            gameMode = mode;
            if (mode === 'solo') {
                showPage('soloLoginPage');
            } else {
                startPartyGame();
            }
        }

        function backToMode() {
            resetGame();
            clearAllTimers();
            showPage('modePage');
        }

        function clearAllTimers() {
            if (partyTimer) clearInterval(partyTimer);
            if (partyClueTimer) clearInterval(partyClueTimer);
            if (gameState.timer) clearInterval(gameState.timer);
        }

        // ========== å¤šäººæ´¾å¯¹æ¨¡å¼ ==========
        function startPartyGame() {
            // éšæœºé€‰æ‹©10é“é¢˜
            const shuffled = [...partyQuestionBank].sort(() => Math.random() - 0.5);
            partyQuestions = shuffled.slice(0, partyTotalQuestions);
            partyCurrentQuestion = 0;
            
            startPartyQuestion();
        }

        function startPartyQuestion() {
            const q = partyQuestions[partyCurrentQuestion];
            partyRevealedClues = 0;
            partyTimeLeft = 45;
            
            // æ›´æ–°é¢˜å·å’Œè¿›åº¦
            document.getElementById('partyQuestionNumber').textContent = `ç¬¬ ${partyCurrentQuestion + 1}/${partyTotalQuestions} é¢˜`;
            document.getElementById('partyProgressFill').style.width = `${((partyCurrentQuestion + 1) / partyTotalQuestions) * 100}%`;
            document.getElementById('partyTimer').textContent = `â° ${partyTimeLeft}ç§’`;
            
            // é‡ç½®æç¤ºè¯æ˜¾ç¤º
            document.getElementById('clue1').textContent = 'â“';
            document.getElementById('clue1').className = 'clue-box';
            document.getElementById('clue2').textContent = 'â“';
            document.getElementById('clue2').className = 'clue-box';
            document.getElementById('clue3').textContent = 'â“';
            document.getElementById('clue3').className = 'clue-box';
            document.getElementById('clueHint').textContent = 'ç¬¬ä¸€ä¸ªæç¤ºè¯å³å°†æ­æ™“...';
            
            showPage('partyQuizPage');
            
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
            clearAllTimers();
            
            // 3ç§’åæ­æ™“ç¬¬ä¸€ä¸ªæç¤ºè¯
            setTimeout(() => {
                revealClue(1);
                startPartyTimers();
            }, 3000);
        }

        function startPartyTimers() {
            // æ€»è®¡æ—¶å™¨
            partyTimer = setInterval(() => {
                partyTimeLeft--;
                document.getElementById('partyTimer').textContent = `â° ${partyTimeLeft}ç§’`;
                
                if (partyTimeLeft <= 10) {
                    document.getElementById('partyTimer').style.background = 'linear-gradient(45deg, #ff4757 0%, #ff3838 100%)';
                }
                
                if (partyTimeLeft <= 0) {
                    clearAllTimers();
                    showPartyAnswer();
                }
            }, 1000);
            
            // æç¤ºè¯æ­æ™“è®¡æ—¶å™¨ï¼ˆæ¯15ç§’æ­æ™“ä¸€ä¸ªï¼‰
            partyClueTimer = setInterval(() => {
                if (partyRevealedClues < 3) {
                    partyRevealedClues++;
                    revealClue(partyRevealedClues);
                }
                if (partyRevealedClues >= 3) {
                    clearInterval(partyClueTimer);
                }
            }, 15000);
        }

        function revealClue(index) {
            const q = partyQuestions[partyCurrentQuestion];
            const clueEl = document.getElementById('clue' + index);
            
            if (clueEl && q.hints[index - 1]) {
                clueEl.textContent = q.hints[index - 1];
                clueEl.className = 'clue-box revealed';
                partyRevealedClues = index;
                
                if (index < 3) {
                    document.getElementById('clueHint').textContent = `å·²æ­æ™“ ${index}/3 ä¸ªæç¤ºè¯ï¼Œä¸‹ä¸€ä¸ª15ç§’åæ­æ™“`;
                } else {
                    document.getElementById('clueHint').textContent = 'æ‰€æœ‰æç¤ºè¯å·²æ­æ™“ï¼å¿«çŒœç­”æ¡ˆå§ï¼';
                }
            }
        }

        function someoneGuessed() {
            clearAllTimers();
            
            const q = partyQuestions[partyCurrentQuestion];
            document.getElementById('partyAnswerCity').textContent = q.answer;
            document.getElementById('partyAnswerDesc').textContent = q.hints.join(' Â· ');
            document.getElementById('partyResultText').textContent = 'ğŸ‰ æ­å–œçŒœå¯¹ï¼å‡†å¤‡ä¸‹ä¸€é¢˜~';
            
            showPage('partyAnswerPage');
        }

        function showPartyAnswer() {
            clearAllTimers();
            
            const q = partyQuestions[partyCurrentQuestion];
            document.getElementById('partyAnswerCity').textContent = q.answer;
            document.getElementById('partyAnswerDesc').textContent = q.hints.join(' Â· ');
            document.getElementById('partyResultText').textContent = 'ç­”æ¡ˆæ­æ™“ï¼å‡†å¤‡ä¸‹ä¸€é¢˜~';
            
            showPage('partyAnswerPage');
        }

        function nextPartyQuestion() {
            partyCurrentQuestion++;
            
            // é‡ç½®è®¡æ—¶å™¨é¢œè‰²
            document.getElementById('partyTimer').style.background = 'linear-gradient(45deg, #ff6b6b 0%, #feca57 100%)';
            
            if (partyCurrentQuestion >= partyTotalQuestions) {
                document.getElementById('partyTotalQuestions').textContent = partyTotalQuestions;
                createConfetti();
                showPage('partyEndPage');
            } else {
                startPartyQuestion();
            }
        }

        function restartPartyGame() {
            startPartyGame();
        }

        // ========== å•äººé—¯å…³æ¨¡å¼ ==========
        function startSoloGame() {
            const nameInput = document.getElementById('soloPlayerName');
            const playerName = nameInput.value.trim();
            
            if (!playerName) {
                alert('è¯·è¾“å…¥æ˜µç§°ï¼');
                return;
            }
            
            gameState.currentPlayer = {
                name: playerName,
                answers: [],
                totalTime: 0,
                accuracy: 0
            };
            gameState.currentLevel = 1;
            gameState.levelResults = [];
            
            startSoloLevel();
        }

        function startSoloLevel() {
            const levelKey = `level${gameState.currentLevel}`;
            const levelQuestions = [...soloQuestionBank[levelKey]];
            
            quizQuestions = levelQuestions.sort(() => Math.random() - 0.5).slice(0, 5);
            
            gameState.currentQuestion = 0;
            gameState.currentPlayer.answers = [];
            gameState.questionStartTime = 0;
            
            const levelNames = ['ç¬¬ä¸€å…³ï¼šå…¥é—¨çº§', 'ç¬¬äºŒå…³ï¼šè¿›é˜¶çº§', 'ç¬¬ä¸‰å…³ï¼šåœ°ç‹±çº§'];
            document.getElementById('levelBadge').textContent = levelNames[gameState.currentLevel - 1];
            
            showPage('quizPage');
            startQuestion();
        }

        function nextLevel() {
            gameState.currentLevel++;
            if (gameState.currentLevel > 3) {
                showSoloFinalResult();
            } else {
                startSoloLevel();
            }
        }

        function showSoloLevelResult() {
            const answers = gameState.currentPlayer.answers;
            const correct = answers.filter(a => a.correct).length;
            const total = answers.length;
            const accuracy = Math.round((correct / total) * 100);
            const totalTime = answers.reduce((sum, a) => sum + a.time, 0);
            
            gameState.levelResults.push({
                level: gameState.currentLevel,
                correct,
                total,
                accuracy,
                time: Math.round(totalTime * 10) / 10
            });
            
            let stars = '';
            if (accuracy >= 100) stars = 'â­â­â­';
            else if (accuracy >= 80) stars = 'â­â­';
            else if (accuracy >= 60) stars = 'â­';
            else stars = 'ğŸ’”';
            
            const levelNames = ['ç¬¬ä¸€å…³', 'ç¬¬äºŒå…³', 'ç¬¬ä¸‰å…³'];
            document.getElementById('levelResultTitle').textContent = 
                accuracy >= 60 ? `ğŸ‰ ${levelNames[gameState.currentLevel - 1]}å®Œæˆï¼` : `ğŸ˜¢ ${levelNames[gameState.currentLevel - 1]}å¤±è´¥...`;
            document.getElementById('levelStars').textContent = stars;
            document.getElementById('levelCorrect').textContent = `${correct}/${total}`;
            document.getElementById('levelAccuracy').textContent = `${accuracy}%`;
            document.getElementById('levelTime').textContent = `${Math.round(totalTime * 10) / 10}ç§’`;
            
            const nextBtn = document.getElementById('nextLevelBtn');
            if (accuracy >= 60 && gameState.currentLevel < 3) {
                nextBtn.style.display = 'inline-block';
                nextBtn.textContent = 'ğŸš€ è¿›å…¥ä¸‹ä¸€å…³';
            } else if (gameState.currentLevel >= 3) {
                showSoloFinalResult();
                return;
            } else {
                nextBtn.style.display = 'none';
            }
            
            showPage('soloLevelResultPage');
            if (accuracy >= 60) createConfetti();
        }

        function showSoloFinalResult() {
            const results = gameState.levelResults;
            const totalCorrect = results.reduce((sum, r) => sum + r.correct, 0);
            const totalQuestions = results.reduce((sum, r) => sum + r.total, 0);
            const totalAccuracy = Math.round((totalCorrect / totalQuestions) * 100);
            const totalTime = results.reduce((sum, r) => sum + r.time, 0);
            
            let stars = '';
            const passedLevels = results.filter(r => r.accuracy >= 60).length;
            if (passedLevels === 3 && totalAccuracy >= 90) stars = 'ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ';
            else if (passedLevels === 3) stars = 'â­â­â­â­';
            else if (passedLevels >= 2) stars = 'â­â­â­';
            else if (passedLevels >= 1) stars = 'â­â­';
            else stars = 'â­';
            
            let title = '';
            if (passedLevels === 3 && totalAccuracy >= 90) title = 'ğŸŠ æ—…æ¸¸è¾¾äººï¼å®Œç¾é€šå…³ï¼';
            else if (passedLevels === 3) title = 'ğŸ‰ æ­å–œé€šå…³ï¼';
            else if (passedLevels >= 2) title = 'ğŸ‘ è¡¨ç°ä¸é”™ï¼';
            else title = 'ğŸ’ª ç»§ç»­åŠ æ²¹ï¼';
            
            document.getElementById('finalTitle').textContent = title;
            document.getElementById('finalStars').textContent = stars;
            document.getElementById('finalCorrect').textContent = `${totalCorrect}/${totalQuestions}`;
            document.getElementById('finalAccuracy').textContent = `${totalAccuracy}%`;
            document.getElementById('finalTime').textContent = `${Math.round(totalTime * 10) / 10}ç§’`;
            
            showPage('soloFinalResultPage');
            createConfetti();
        }

        // å•äººç­”é¢˜é€»è¾‘
        function startQuestion() {
            const questionNumber = document.getElementById('questionNumber');
            const progressFill = document.getElementById('progressFill');
            const mysteryBox = document.getElementById('mysteryBox');
            const clueArea = document.getElementById('clueArea');
            const answerInput = document.getElementById('answerInput');
            const submitBtn = document.getElementById('submitBtn');
            
            questionNumber.textContent = `ç¬¬ ${gameState.currentQuestion + 1}/${quizQuestions.length} é¢˜`;
            const progress = ((gameState.currentQuestion + 1) / quizQuestions.length) * 100;
            progressFill.style.width = `${progress}%`;
            
            mysteryBox.innerHTML = `
                <h3>ğŸ ç‚¹å‡»æŠ½å–æ—…æ¸¸ç›²ç›’</h3>
                <p>ç¥ç§˜çš„æ—…æ¸¸ç›®çš„åœ°ç­‰ä½ å‘ç°ï¼</p>
            `;
            clueArea.innerHTML = '<div class="clue-content">ç‚¹å‡»ä¸Šæ–¹ç›²ç›’è·å–3ä¸ªå…³é”®è¯æç¤º...</div>';
            answerInput.value = '';
            answerInput.disabled = true;
            submitBtn.disabled = true;
            
            document.getElementById('timer').style.background = 'linear-gradient(45deg, #ff6b6b 0%, #feca57 100%)';
            
            gameState.timeLeft = 60;
            gameState.questionStartTime = Date.now();
            startTimer();
        }

        function openMysteryBox() {
            const mysteryBox = document.getElementById('mysteryBox');
            const clueArea = document.getElementById('clueArea');
            const answerInput = document.getElementById('answerInput');
            const submitBtn = document.getElementById('submitBtn');
            
            const currentQ = quizQuestions[gameState.currentQuestion];
            mysteryBox.innerHTML = `
                <h3>ğŸ ç›²ç›’å·²å¼€å¯ï¼</h3>
                <p>æ ¹æ®å…³é”®è¯çŒœç­”æ¡ˆ</p>
            `;
            
            const hintsHtml = currentQ.hints.map(hint => 
                `<div class="hint-card">${hint}</div>`
            ).join('');
            clueArea.innerHTML = `<div class="hints-container">${hintsHtml}</div>`;
            
            answerInput.disabled = false;
            submitBtn.disabled = false;
            answerInput.focus();
            
            answerInput.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    submitAnswer();
                }
            };
        }

        function submitAnswer() {
            const answerInput = document.getElementById('answerInput');
            const submitBtn = document.getElementById('submitBtn');
            const userAnswer = answerInput.value.trim();
            
            if (!userAnswer) {
                alert('è¯·è¾“å…¥ç­”æ¡ˆï¼');
                return;
            }
            
            submitBtn.disabled = true;
            answerInput.disabled = true;
            
            const answerTime = (Date.now() - gameState.questionStartTime) / 1000;
            const currentQ = quizQuestions[gameState.currentQuestion];
            const isCorrect = checkAnswer(userAnswer, currentQ);
            
            gameState.currentPlayer.answers.push({
                correct: isCorrect,
                time: Math.round(answerTime * 10) / 10
            });
            
            clearInterval(gameState.timer);
            showAnswerFeedback(isCorrect, currentQ.answer);
            
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        function checkAnswer(userAnswer, question) {
            return question.keywords.some(keyword => 
                userAnswer.toLowerCase().includes(keyword.toLowerCase())
            );
        }

        function showAnswerFeedback(isCorrect, correctAnswer) {
            const clueArea = document.getElementById('clueArea');
            let feedback = '';
            
            if (isCorrect) {
                feedback = `<div class="clue-content" style="color: #48bb78; font-size: 24px;">âœ… å›ç­”æ­£ç¡®ï¼</div>`;
            } else {
                feedback = `<div class="clue-content" style="color: #f56565; font-size: 24px;">âŒ å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer}</div>`;
            }
            clueArea.innerHTML = feedback;
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion >= quizQuestions.length) {
                showSoloLevelResult();
            } else {
                startQuestion();
            }
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
            }
            
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                timerElement.textContent = `â° ${gameState.timeLeft}ç§’`;
                
                if (gameState.timeLeft <= 10) {
                    timerElement.style.background = 'linear-gradient(45deg, #ff4757 0%, #ff3838 100%)';
                }
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    timeUp();
                }
            }, 1000);
        }

        function timeUp() {
            gameState.currentPlayer.answers.push({
                correct: false,
                time: 60
            });
            
            showAnswerFeedback(false, quizQuestions[gameState.currentQuestion].answer);
            
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        // å·¥å…·å‡½æ•°
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function resetGame() {
            clearAllTimers();
            
            gameState = {
                currentPlayer: null,
                currentQuestion: 0,
                currentLevel: 1,
                timer: null,
                timeLeft: 60,
                questionStartTime: 0,
                levelResults: []
            };
            
            partyQuestions = [];
            partyCurrentQuestion = 0;
            partyRevealedClues = 0;
            
            document.getElementById('soloPlayerName').value = '';
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 100);
            }
        }

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            console.log('æ¸¸æˆåŠ è½½å®Œæˆ');
        };

        window.onbeforeunload = function() {
            clearAllTimers();
        };
    </script>
</body>
</html>
