<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ è°æ˜¯æˆ‘çš„ç¤¼ç‰©æ­å­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            overflow-x: hidden;
        }

        /* æ˜Ÿæ˜ŸèƒŒæ™¯åŠ¨ç”» */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ffd700, #ff6b6b, #ffd700);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shine 3s linear infinite;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        .header p {
            color: #a0a0a0;
            margin-top: 10px;
            font-size: 1.1rem;
        }

        /* ç©æ³•è¯´æ˜å¡ç‰‡ */
        .rules-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .rules-card h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rules-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .step:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateX(5px);
        }

        .step-num {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-text {
            color: #e0e0e0;
            line-height: 1.6;
        }

        .step-text strong {
            color: #ffd700;
        }

        /* ä¸»è¦å†…å®¹åŒº */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-section h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .input-section textarea {
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: #fff;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .input-section textarea:focus {
            outline: none;
            border-color: #ffd700;
        }

        .input-section textarea::placeholder {
            color: #666;
        }

        .input-hint {
            color: #888;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* å‚ä¸è€…å±•ç¤º */
        .participants-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .participant-tag {
            padding: 8px 16px;
            background: rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ffd700;
            transition: all 0.3s;
        }

        .participant-tag.drawn {
            background: rgba(100, 100, 100, 0.2);
            border-color: rgba(100, 100, 100, 0.3);
            color: #666;
            text-decoration: line-through;
        }

        .participant-tag.current {
            animation: pulse 0.5s infinite;
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* æŠ½ç­¾åŒºåŸŸ */
        .draw-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .current-drawer {
            margin-bottom: 25px;
        }

        .current-drawer-label {
            color: #888;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .current-drawer-name {
            font-size: 1.8rem;
            color: #ffd700;
            font-weight: bold;
        }

        /* æ°”æ³¡åŒºåŸŸ */
        .bubble-area {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 20px 0;
            overflow: hidden;
            border-radius: 16px;
            background: linear-gradient(180deg, rgba(100, 200, 255, 0.1) 0%, rgba(150, 100, 255, 0.1) 100%);
        }

        /* æ°”æ³¡æ ·å¼ */
        .bubble {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            text-align: center;
            font-weight: 500;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            padding: 10px;
            word-break: break-all;
            font-size: 0.75rem;
        }

        .bubble::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 30%;
            height: 20%;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: rotate(-30deg);
        }

        .bubble:hover {
            transform: scale(1.15) !important;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            z-index: 10;
        }

        .bubble.floating {
            animation: bubbleFloat var(--float-duration, 4s) ease-in-out infinite;
            animation-delay: var(--float-delay, 0s);
        }

        @keyframes bubbleFloat {
            0% { 
                transform: translate(0, 0) rotate(0deg) scale(1); 
            }
            20% { 
                transform: translate(var(--move-x1), var(--move-y1)) rotate(var(--rot1)) scale(1.02); 
            }
            40% { 
                transform: translate(var(--move-x2), var(--move-y2)) rotate(var(--rot2)) scale(0.98); 
            }
            60% { 
                transform: translate(var(--move-x3), var(--move-y3)) rotate(var(--rot3)) scale(1.03); 
            }
            80% { 
                transform: translate(var(--move-x4), var(--move-y4)) rotate(var(--rot4)) scale(0.99); 
            }
            100% { 
                transform: translate(0, 0) rotate(0deg) scale(1); 
            }
        }

        /* æ°”æ³¡å…‰æ³½é—ªçƒ */
        .bubble::after {
            content: '';
            position: absolute;
            bottom: 20%;
            right: 20%;
            width: 15%;
            height: 10%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: shimmer 2s ease-in-out infinite;
            animation-delay: var(--shimmer-delay, 0s);
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .bubble.pop {
            animation: bubblePop 0.5s forwards;
        }

        @keyframes bubblePop {
            0% { transform: scale(1); opacity: 1; }
            30% { transform: scale(1.3); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        .bubble.fly-to-box {
            animation: flyToBox 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes flyToBox {
            0% { 
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(0.5);
                opacity: 0.8;
            }
            100% { 
                transform: scale(0.1);
                opacity: 0;
            }
        }

        /* æ°”æ³¡çˆ†ç‚¸ç¢ç‰‡ */
        .bubble-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: particleFly 0.6s forwards;
            pointer-events: none;
        }

        @keyframes particleFly {
            0% { 
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(var(--px), var(--py)) scale(0);
                opacity: 0;
            }
        }

        /* æŠ½ç­¾åŠ¨ç”»åŒº - ç¤¼ç‰©ç›’ */
        .draw-box {
            width: 180px;
            height: 180px;
            margin: 0 auto 25px;
            position: relative;
            perspective: 1000px;
        }

        .gift-box {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .gift-box.shake {
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .gift-box.open .box-lid {
            transform: rotateX(-110deg) translateY(-30px);
        }

        .box-body {
            width: 130px;
            height: 100px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border-radius: 10px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .box-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 100%;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
        }

        .box-lid {
            width: 140px;
            height: 25px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border-radius: 5px;
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: bottom center;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
        }

        .box-lid::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
        }

        .box-lid::after {
            content: 'ğŸ€';
            position: absolute;
            top: -22px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
        }

        /* åå­—æ˜¾ç¤º */
        .name-display {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            white-space: nowrap;
        }

        .name-display.show {
            opacity: 1;
        }

        .name-display.revealed {
            animation: reveal 0.5s forwards;
            color: #ffd700;
            font-size: 1.5rem;
        }

        @keyframes reveal {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .draw-btn {
            padding: 18px 50px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            border: none;
            border-radius: 30px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 25px rgba(255, 215, 0, 0.3);
        }

        .draw-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 35px rgba(255, 215, 0, 0.5);
        }

        .draw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .next-btn {
            display: none;
            padding: 16px 45px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            border-radius: 30px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 25px rgba(79, 172, 254, 0.3);
            margin-top: 15px;
            animation: nextBtnPulse 1.5s infinite;
        }

        .next-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 35px rgba(79, 172, 254, 0.5);
        }

        .next-btn.show {
            display: inline-block;
        }

        @keyframes nextBtnPulse {
            0%, 100% { box-shadow: 0 5px 25px rgba(79, 172, 254, 0.3); }
            50% { box-shadow: 0 5px 35px rgba(79, 172, 254, 0.6); }
        }

        .restart-btn {
            padding: 12px 30px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .restart-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        /* æç¤ºæ–‡å­— */
        .draw-hint {
            color: #888;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        /* ç»“æœå±•ç¤ºåŒº */
        .results-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-section h3 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.1);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .result-giver {
            color: #fff;
            font-weight: 500;
        }

        .result-arrow {
            color: #a0a0a0;
            font-size: 0.95rem;
            margin: 0 15px;
        }

        .result-receiver {
            color: #ffd700;
            font-weight: bold;
            padding: 5px 15px;
            background: rgba(255, 215, 0, 0.15);
            border-radius: 15px;
        }

        /* å®Œæˆåº†ç¥ */
        .celebration {
            display: none;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s;
        }

        .celebration.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .celebration h2 {
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .celebration p {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        /* çƒŸèŠ±æ•ˆæœ */
        .firework {
            position: fixed;
            pointer-events: none;
            z-index: 100;
        }

        .firework-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: fireworkExplode 1s forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .draw-box {
                width: 160px;
                height: 160px;
            }

            .box-body {
                width: 120px;
                height: 100px;
            }

            .box-lid {
                width: 130px;
                bottom: 100px;
            }

            .result-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .result-arrow {
                transform: rotate(90deg);
                margin: 5px 0;
            }
        }

        /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒåŠŸèƒ½ */
        .results-list::-webkit-scrollbar {
            width: 6px;
        }

        .results-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .results-list::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
        }

        /* å¯çˆ±æç¤ºå¼¹çª— */
        .cute-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4);
            z-index: 1000;
            text-align: center;
            animation: toastPop 0.5s forwards;
        }

        @keyframes toastPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); }
            50% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }

        .cute-toast.hide {
            animation: toastHide 0.3s forwards;
        }

        @keyframes toastHide {
            to { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }

        .cute-toast-emoji {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: bounce 0.5s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .cute-toast-text {
            color: #333;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .cute-toast-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .cute-toast-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        /* é®ç½©å±‚ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            animation: fadeInOverlay 0.3s forwards;
        }

        @keyframes fadeInOverlay {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿæ˜ŸèƒŒæ™¯ -->
    <div class="stars" id="stars"></div>

    <div class="container">
        <!-- æ ‡é¢˜ -->
        <header class="header">
            <h1>ğŸ è°æ˜¯æˆ‘çš„ç¤¼ç‰©æ­å­ ğŸ</h1>
            <p>æŠ½ä¸­è°ï¼ŒTAå°±æ˜¯ä½ çš„å¹´ä¼šç¤¼ç‰©æ­å­ï¼</p>
        </header>

        <!-- ç©æ³•è¯´æ˜ -->
        <div class="rules-card">
            <h3>âœ¨ ç©æ³•è¯´æ˜ - æ‰“å¼€æƒŠå–œ</h3>
            <div class="rules-steps">
                <div class="step">
                    <span class="step-num">1</span>
                    <span class="step-text"><strong>è¾“å…¥åå•</strong>ï¼šå°†æ‰€æœ‰å‚ä¸è€…å§“åè¾“å…¥ä¸‹æ–¹ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼Œç‚¹å‡»ã€Œç¡®è®¤åå•ã€</span>
                </div>
                <div class="step">
                    <span class="step-num">2</span>
                    <span class="step-text"><strong>è½®æµæŠ½ç­¾</strong>ï¼šæŒ‰é¡ºåºæ¯äººç‚¹å‡»ã€Œå¼€å¯ç¤¼ç›’ã€ï¼ŒæŠ½å–ä½ è¦é€ç¤¼ç‰©çš„å¯¹è±¡ï¼ˆä¸èƒ½æŠ½åˆ°è‡ªå·±å“¦~ï¼‰</span>
                </div>
                <div class="step">
                    <span class="step-num">3</span>
                    <span class="step-text"><strong>æƒŠå–œæ­æ™“</strong>ï¼šæ‰“å¼€æƒŠå–œç›’å­ï¼Œè¿æ¥ä½ çš„ä¸“å±ç¤¼ç‰©å§ï¼ğŸ‰</span>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div class="main-content">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section" id="inputSection">
                <h3>ğŸ“ è¾“å…¥å‚ä¸è€…åå•ï¼ˆ1-15äººï¼‰</h3>
                <textarea id="nameInput" placeholder="è¯·è¾“å…¥å‚ä¸è€…å§“åï¼Œæ¯è¡Œä¸€ä¸ª&#10;ä¾‹å¦‚ï¼š&#10;å¼ ä¸‰&#10;æå››&#10;ç‹äº”&#10;..."></textarea>
                <p class="input-hint">ğŸ’¡ æç¤ºï¼šæ”¯æŒ1-15äººå‚ä¸ï¼Œæ¯äººåªèƒ½æŠ½ä¸€æ¬¡ï¼Œä¸ä¼šæŠ½åˆ°è‡ªå·±</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="confirmNames()">âœ… ç¡®è®¤åå•</button>
                    <button class="btn btn-secondary" onclick="loadExample()">ğŸ“‹ åŠ è½½å›¢é˜Ÿåå•</button>
                </div>
                <div class="participants-display" id="participantsDisplay"></div>
            </div>

            <!-- æŠ½ç­¾åŒºåŸŸ -->
            <div class="draw-section" id="drawSection" style="display: none;">
                <div class="current-drawer">
                    <div class="current-drawer-label">ğŸ¯ å½“å‰æŠ½ç­¾äºº</div>
                    <div class="current-drawer-name" id="currentDrawer">-</div>
                </div>

                <!-- æ°”æ³¡åŒºåŸŸ -->
                <div class="bubble-area" id="bubbleArea"></div>

                <!-- ç¤¼ç‰©ç›’ -->
                <div class="draw-box">
                    <div class="gift-box" id="giftBox">
                        <div class="box-lid"></div>
                        <div class="box-body"></div>
                    </div>
                    <div class="name-display" id="nameDisplay">?</div>
                </div>

                <button class="draw-btn" id="drawBtn" onclick="startDraw()">ğŸ æŠ½å–ä½ çš„æƒŠå–œç¤¼ç‰©</button>
                <button class="next-btn" id="nextBtn" onclick="goToNextPerson()">ğŸ‘‰ ä¸‹ä¸€ä½æŠ½ç­¾</button>
                <button class="restart-btn" id="restartBtn" onclick="restartDraw()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <p class="draw-hint" id="drawHint">ç‚¹å‡»æŒ‰é’®ï¼Œæ­æ™“ä½ çš„ç¤¼ç‰©æ­å­ï¼</p>

                <div class="participants-display" id="remainingDisplay" style="margin-top: 25px;"></div>
            </div>

            <!-- ç»“æœå±•ç¤º -->
            <div class="results-section" id="resultsSection" style="display: none;">
                <h3>ğŸŠ æŠ½ç­¾ç»“æœ</h3>
                <div class="results-list" id="resultsList"></div>
            </div>

            <!-- å®Œæˆåº†ç¥ -->
            <div class="celebration" id="celebration">
                <h2>ğŸ‰ ç¤¼ç‰©äº¤æ¢å®Œæ¯•ï¼ğŸ‰</h2>
                <p>é¢„ç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼Œå¹¸ç¦å¤šå¤šï¼</p>
                <button class="btn btn-primary" style="margin-top: 20px;" onclick="resetAll()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒæ•°æ® ====================
        let participants = [];      // æ‰€æœ‰å‚ä¸è€…
        let availableTargets = [];  // å¯è¢«æŠ½å–çš„äºº
        let currentDrawerIndex = 0; // å½“å‰æŠ½ç­¾äººç´¢å¼•
        let results = [];           // æŠ½ç­¾ç»“æœ [{giver, receiver}]
        let isDrawing = false;      // æ˜¯å¦æ­£åœ¨æŠ½ç­¾

        // ==================== åˆå§‹åŒ– ====================
        window.onload = function() {
            createStars();
            // è‡ªåŠ¨åŠ è½½é¢„ç½®åå•
            loadExample();
        };

        // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                star.style.width = (Math.random() * 3 + 1) + 'px';
                star.style.height = star.style.width;
                starsContainer.appendChild(star);
            }
        }

        // ==================== åå•ç®¡ç† ====================
        
        // é¢„ç½®å‚ä¸è€…åå•ï¼ˆ10äººï¼‰
        const presetParticipants = [
            'æˆ´ä¿Šä¿Š(raymonddai)',
            'å¸¸æº(fionachang)',
            'æ¢æ–‡ç¿(ainsonliang)',
            'äºæ¢¦çª(ameliamqyu)',
            'å§šè‡´é (edisonyiu)',
            'ææµ©æ¥ (robinhnli)',
            'ç‹æ—­å½¤(kathytwang)',
            'ä½™ç››ä½³(seikayu)',
            'å¯¿ä½³é›¯(jiawenshou)',
            'é‚“é›¨çŠ(sanniyadeng)'
        ];

        // åŠ è½½é¢„ç½®åå•
        function loadExample() {
            document.getElementById('nameInput').value = presetParticipants.join('\n');
        }

        // ç¡®è®¤åå•
        function confirmNames() {
            const input = document.getElementById('nameInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥å‚ä¸è€…åå•ï¼');
                return;
            }

            // è§£æåå•ï¼Œå»é‡å»ç©º
            const names = input.split('\n')
                .map(n => n.trim())
                .filter(n => n.length > 0);
            
            const uniqueNames = [...new Set(names)];

            if (uniqueNames.length < 2) {
                alert('è‡³å°‘éœ€è¦2äººæ‰èƒ½è¿›è¡ŒæŠ½ç­¾ï¼');
                return;
            }

            if (uniqueNames.length > 15) {
                alert('æœ€å¤šæ”¯æŒ15äººå‚ä¸ï¼');
                return;
            }

            // åˆå§‹åŒ–æ•°æ®
            participants = uniqueNames;
            // æ‰“ä¹±å¯æŠ½å–åˆ—è¡¨é¡ºåºï¼Œå¢åŠ éšæœºæ€§
            availableTargets = shuffleArray([...uniqueNames]);
            currentDrawerIndex = 0;
            results = [];
            
            // é¢„å…ˆç”Ÿæˆå®Œç¾åŒ¹é…ï¼Œç¡®ä¿æ²¡æœ‰äººæŠ½åˆ°è‡ªå·±
            perfectMatching = generatePerfectMatching(uniqueNames);

            // æ˜¾ç¤ºå‚ä¸è€…æ ‡ç­¾
            updateParticipantsDisplay();

            // åˆ‡æ¢åˆ°æŠ½ç­¾ç•Œé¢
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('drawSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'block';

            // æ›´æ–°å½“å‰æŠ½ç­¾äºº
            updateCurrentDrawer();
        }

        // æ›´æ–°å‚ä¸è€…æ˜¾ç¤º
        function updateParticipantsDisplay() {
            const display = document.getElementById('remainingDisplay');
            display.innerHTML = '';
            
            // åŒæ—¶æ›´æ–°æ°”æ³¡åŒºåŸŸ
            createBubbles();
        }

        // æ°”æ³¡é¢œè‰²æ•°ç»„
        const bubbleColors = [
            'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
            'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)',
            'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
            'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
            'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
            'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
            'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
            'linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
        ];

        // åˆ›å»ºæ°”æ³¡
        function createBubbles() {
            const bubbleArea = document.getElementById('bubbleArea');
            bubbleArea.innerHTML = '';
            
            const currentDrawer = participants[currentDrawerIndex];
            // åªæ˜¾ç¤ºå¯è¢«æŠ½å–çš„äººï¼ˆæ’é™¤è‡ªå·±ï¼‰
            const displayTargets = availableTargets.filter(name => name !== currentDrawer);
            
            displayTargets.forEach((name, index) => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble floating';
                bubble.dataset.name = name;
                
                // éšæœºå¤§å° (70-100px)
                const size = 70 + Math.random() * 30;
                bubble.style.width = size + 'px';
                bubble.style.height = size + 'px';
                
                // éšæœºä½ç½®ï¼ˆé¿å…é‡å ï¼‰
                const areaWidth = bubbleArea.offsetWidth || 800;
                const areaHeight = bubbleArea.offsetHeight || 300;
                const maxX = areaWidth - size - 20;
                const maxY = areaHeight - size - 20;
                
                // ä½¿ç”¨ç½‘æ ¼åˆ†å¸ƒé¿å…é‡å 
                const cols = Math.ceil(Math.sqrt(displayTargets.length * 2));
                const rows = Math.ceil(displayTargets.length / cols);
                const cellWidth = maxX / cols;
                const cellHeight = maxY / rows;
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                const baseX = col * cellWidth + 10;
                const baseY = row * cellHeight + 10;
                const randomOffsetX = Math.random() * (cellWidth * 0.5);
                const randomOffsetY = Math.random() * (cellHeight * 0.5);
                
                bubble.style.left = Math.min(baseX + randomOffsetX, maxX) + 'px';
                bubble.style.top = Math.min(baseY + randomOffsetY, maxY) + 'px';
                
                // éšæœºé¢œè‰²
                bubble.style.background = bubbleColors[index % bubbleColors.length];
                bubble.style.boxShadow = '0 5px 20px rgba(255, 255, 255, 0.3), inset 0 -5px 20px rgba(0, 0, 0, 0.1)';
                
                // éšæœºåŠ¨ç”»å‚æ•° - æ¯ä¸ªæ°”æ³¡ç‹¬ç«‹çš„éšæœºæ¼‚æµ®è½¨è¿¹
                const duration = 3 + Math.random() * 4;  // åŠ¨ç”»å‘¨æœŸ 3-7s
                bubble.style.setProperty('--float-duration', duration + 's');
                bubble.style.setProperty('--float-delay', (Math.random() * 2) + 's');
                bubble.style.setProperty('--shimmer-delay', (Math.random() * 2) + 's');
                
                // ç”Ÿæˆéšæœºç§»åŠ¨è·¯å¾„ç‚¹ï¼ˆ4ä¸ªä¸­é—´ç‚¹ï¼‰
                for (let i = 1; i <= 4; i++) {
                    const moveX = (Math.random() > 0.5 ? 1 : -1) * (10 + Math.random() * 25);
                    const moveY = (Math.random() > 0.5 ? 1 : -1) * (10 + Math.random() * 20);
                    const rot = (Math.random() > 0.5 ? 1 : -1) * (3 + Math.random() * 8);
                    bubble.style.setProperty('--move-x' + i, moveX + 'px');
                    bubble.style.setProperty('--move-y' + i, moveY + 'px');
                    bubble.style.setProperty('--rot' + i, rot + 'deg');
                }
                
                // æ˜¾ç¤ºåå­—ï¼ˆæˆªå–æ˜¾ç¤ºï¼‰
                const displayName = name.length > 6 ? name.substring(0, 6) + '..' : name;
                bubble.textContent = displayName;
                bubble.title = name;
                
                bubbleArea.appendChild(bubble);
            });
        }

        // æ›´æ–°å½“å‰æŠ½ç­¾äºº
        function updateCurrentDrawer() {
            if (currentDrawerIndex < participants.length) {
                document.getElementById('currentDrawer').textContent = participants[currentDrawerIndex];
            }
        }

        // ==================== æŠ½ç­¾é€»è¾‘ ====================

        // é¢„å…ˆç”Ÿæˆå®Œç¾åŒ¹é…ï¼ˆç¡®ä¿æ²¡æœ‰äººæŠ½åˆ°è‡ªå·±ï¼‰
        let perfectMatching = [];  // é¢„å…ˆè®¡ç®—å¥½çš„åŒ¹é…ç»“æœ

        // ç”Ÿæˆå®Œç¾åŒ¹é… - ä½¿ç”¨é”™æ’ç®—æ³•ç¡®ä¿æ²¡æœ‰äººæŠ½åˆ°è‡ªå·±
        function generatePerfectMatching(names) {
            const n = names.length;
            if (n < 2) return [];
            
            // å¤åˆ¶æ•°ç»„å¹¶æ‰“ä¹±
            let shuffled = shuffleArray([...names]);
            
            // ä½¿ç”¨é”™æ’ç®—æ³•ï¼šç¡®ä¿ shuffled[i] != names[i] å¯¹æ‰€æœ‰ i æˆç«‹
            // æ–¹æ³•ï¼šç”Ÿæˆä¸€ä¸ªé”™æ’ï¼ˆderangementï¼‰
            let result = generateDerangement(names);
            
            return result;
        }

        // ç”Ÿæˆé”™æ’ï¼ˆDerangementï¼‰- ä¿è¯æ²¡æœ‰å…ƒç´ åœ¨åŸä½ç½®
        function generateDerangement(names) {
            const n = names.length;
            let indices = Array.from({length: n}, (_, i) => i);
            let deranged;
            let maxAttempts = 1000;
            let attempts = 0;
            
            do {
                deranged = shuffleArray([...indices]);
                attempts++;
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„é”™æ’ï¼ˆæ²¡æœ‰äººåœ¨åŸä½ç½®ï¼‰
            } while (hasFixedPoint(indices, deranged) && attempts < maxAttempts);
            
            // å¦‚æœéšæœºæ–¹æ³•å¤±è´¥ï¼Œä½¿ç”¨ç¡®å®šæ€§æ–¹æ³•
            if (hasFixedPoint(indices, deranged)) {
                deranged = createDeterministicDerangement(n);
            }
            
            // è¿”å›åŒ¹é…ç»“æœï¼šnames[i] é€ç»™ names[deranged[i]]
            return names.map((name, i) => ({
                giver: name,
                receiver: names[deranged[i]]
            }));
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰å›ºå®šç‚¹ï¼ˆæœ‰äººæŠ½åˆ°è‡ªå·±ï¼‰
        function hasFixedPoint(original, permuted) {
            for (let i = 0; i < original.length; i++) {
                if (original[i] === permuted[i]) return true;
            }
            return false;
        }

        // ç¡®å®šæ€§é”™æ’ç”Ÿæˆï¼ˆå¾ªç¯ç§»ä½æ³•ï¼‰
        function createDeterministicDerangement(n) {
            // ç®€å•çš„å¾ªç¯ç§»ä½ï¼šæ¯ä¸ªäººæŠ½ä¸‹ä¸€ä¸ªäºº
            // ä½†ä¸ºäº†å¢åŠ éšæœºæ€§ï¼Œå…ˆæ‰“ä¹±åŸæ•°ç»„å†ç§»ä½
            let indices = Array.from({length: n}, (_, i) => i);
            indices = shuffleArray(indices);
            
            // å¾ªç¯ç§»ä½
            let result = [];
            for (let i = 0; i < n; i++) {
                result[indices[i]] = indices[(i + 1) % n];
            }
            return result;
        }

        // å¼€å§‹æŠ½ç­¾
        function startDraw() {
            if (isDrawing) return;
            
            const currentDrawer = participants[currentDrawerIndex];
            
            // ä»é¢„å…ˆè®¡ç®—çš„åŒ¹é…ä¸­è·å–ç»“æœ
            const matchResult = perfectMatching.find(m => m.giver === currentDrawer);
            
            if (!matchResult) {
                alert('æŠ½ç­¾å‡ºç°å¼‚å¸¸ï¼Œè¯·é‡æ–°å¼€å§‹ï¼');
                return;
            }

            // æ£€æŸ¥ç›®æ ‡æ˜¯å¦è¿˜åœ¨å¯æŠ½å–åˆ—è¡¨ä¸­
            if (!availableTargets.includes(matchResult.receiver)) {
                alert('æŠ½ç­¾å‡ºç°å¼‚å¸¸ï¼Œè¯·é‡æ–°å¼€å§‹ï¼');
                return;
            }

            proceedWithDraw([matchResult.receiver]);
        }

        // æ‰§è¡ŒæŠ½ç­¾
        function proceedWithDraw(canDraw) {
            isDrawing = true;
            const drawBtn = document.getElementById('drawBtn');
            drawBtn.disabled = true;

            // ç›®æ ‡å·²ç»ç”±å®Œç¾åŒ¹é…ç®—æ³•ç¡®å®š
            const target = canDraw[0];

            // å¼€å§‹æ°”æ³¡åŠ¨ç”»
            startBubbleAnimation(target);
        }

        // Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = cryptoRandom(i + 1);
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ä½¿ç”¨ crypto API ç”Ÿæˆæ›´éšæœºçš„æ•°å­—
        function cryptoRandom(max) {
            if (window.crypto && window.crypto.getRandomValues) {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] % max;
            }
            // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨æ—¶é—´æˆ³å¢å¼ºéšæœºæ€§
            const timestamp = Date.now();
            const random1 = Math.random();
            const random2 = Math.random();
            return Math.floor((random1 * random2 * timestamp) % max);
        }

        // æ°”æ³¡æŠ½ç­¾åŠ¨ç”»
        function startBubbleAnimation(target) {
            const bubbleArea = document.getElementById('bubbleArea');
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            
            // æ‰¾åˆ°ç›®æ ‡æ°”æ³¡
            const bubbles = bubbleArea.querySelectorAll('.bubble');
            let targetBubble = null;
            
            bubbles.forEach(bubble => {
                if (bubble.dataset.name === target) {
                    targetBubble = bubble;
                }
            });
            
            if (!targetBubble) {
                // å¦‚æœæ²¡æ‰¾åˆ°ï¼ˆå¯èƒ½æ˜¯ç‰¹æ®Šæƒ…å†µï¼‰ï¼Œç›´æ¥æ˜¾ç¤ºç»“æœ
                showResult(target);
                return;
            }
            
            // 1ç§’åæˆ³ç ´ç›®æ ‡æ°”æ³¡
            setTimeout(() => {
                // åœæ­¢ç›®æ ‡æ°”æ³¡çš„æµ®åŠ¨åŠ¨ç”»
                targetBubble.classList.remove('floating');
                
                // åˆ›å»ºçˆ†ç‚¸ç²’å­æ•ˆæœ
                createBubbleParticles(targetBubble);
                
                // æ°”æ³¡æˆ³ç ´åŠ¨ç”»
                targetBubble.classList.add('pop');
                
                // æ’­æ”¾æˆ³ç ´éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
                // playPopSound();
                
                // æ°”æ³¡æ¶ˆå¤±åï¼Œç¤¼ç›’æ‰“å¼€æ˜¾ç¤ºåå­—
                setTimeout(() => {
                    targetBubble.style.display = 'none';
                    
                    // ç¤¼ç›’æŠ–åŠ¨
                    giftBox.classList.add('shake');
                    
                    setTimeout(() => {
                        giftBox.classList.remove('shake');
                        giftBox.classList.add('open');
                        
                        // æ˜¾ç¤ºåå­—
                        setTimeout(() => {
                            nameDisplay.classList.add('show', 'revealed');
                            nameDisplay.textContent = target;
                            
                            // æ”¾çƒŸèŠ±
                            createFirework();
                            createFirework();
                            
                            // è®°å½•ç»“æœ
                            setTimeout(() => {
                                recordResult(target);
                            }, 1500);
                        }, 500);
                    }, 500);
                }, 500);
            }, 1000);
        }

        // åˆ›å»ºæ°”æ³¡çˆ†ç‚¸ç²’å­
        function createBubbleParticles(bubble) {
            const rect = bubble.getBoundingClientRect();
            const bubbleArea = document.getElementById('bubbleArea');
            const areaRect = bubbleArea.getBoundingClientRect();
            
            const centerX = rect.left - areaRect.left + rect.width / 2;
            const centerY = rect.top - areaRect.top + rect.height / 2;
            
            const colors = ['#ff9a9e', '#a18cd1', '#ffecd2', '#84fab0', '#a1c4fd', '#ffd700'];
            
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'bubble-particle';
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (i / 12) * Math.PI * 2;
                const distance = 40 + Math.random() * 40;
                particle.style.setProperty('--px', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--py', Math.sin(angle) * distance + 'px');
                
                bubbleArea.appendChild(particle);
                
                // ç§»é™¤ç²’å­
                setTimeout(() => particle.remove(), 600);
            }
        }

        // æ˜¾ç¤ºç»“æœï¼ˆå¤‡ç”¨ï¼‰
        function showResult(target) {
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            
            giftBox.classList.add('open');
            nameDisplay.classList.add('show', 'revealed');
            nameDisplay.textContent = target;
            createFirework();
            
            setTimeout(() => {
                recordResult(target);
            }, 1500);
        }

        // è®°å½•ç»“æœ
        function recordResult(target) {
            const currentDrawer = participants[currentDrawerIndex];
            
            // æ·»åŠ ç»“æœ
            results.push({
                giver: currentDrawer,
                receiver: target
            });

            // ä»å¯æŠ½å–åˆ—è¡¨ä¸­ç§»é™¤
            availableTargets = availableTargets.filter(name => name !== target);

            // æ›´æ–°ç»“æœåˆ—è¡¨
            updateResultsList();

            // é‡ç½®ç¤¼ç›’çŠ¶æ€
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            const drawBtn = document.getElementById('drawBtn');
            const nextBtn = document.getElementById('nextBtn');
            const drawHint = document.getElementById('drawHint');
            
            setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªäºº
                if (currentDrawerIndex + 1 >= participants.length) {
                    // æ‰€æœ‰äººéƒ½æŠ½å®Œäº†
                    giftBox.classList.remove('open');
                    nameDisplay.classList.remove('show', 'revealed');
                    nameDisplay.textContent = '?';
                    showCelebration();
                } else {
                    // è¿˜æœ‰ä¸‹ä¸€ä¸ªäººï¼Œæ˜¾ç¤º"ä¸‹ä¸€ä½"æŒ‰é’®
                    drawBtn.style.display = 'none';
                    nextBtn.classList.add('show');
                    drawHint.textContent = 'ç‚¹å‡»ã€Œä¸‹ä¸€ä½æŠ½ç­¾ã€æŒ‰é’®ï¼Œè®©ä¸‹ä¸€ä½å°ä¼™ä¼´æ¥æŠ½ç­¾å§ï¼';
                    isDrawing = false;
                    
                    // åœæ­¢æ‰€æœ‰æ°”æ³¡åŠ¨ç”»
                    stopBubbleAnimations();
                }
            }, 1000);
        }

        // åœæ­¢æ°”æ³¡åŠ¨ç”»
        function stopBubbleAnimations() {
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach(bubble => {
                bubble.classList.remove('floating');
            });
        }

        // ä¸‹ä¸€ä½æŠ½ç­¾
        function goToNextPerson() {
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            const drawBtn = document.getElementById('drawBtn');
            const nextBtn = document.getElementById('nextBtn');
            const drawHint = document.getElementById('drawHint');
            
            // é‡ç½®ç¤¼ç›’çŠ¶æ€
            giftBox.classList.remove('open');
            nameDisplay.classList.remove('show', 'revealed');
            nameDisplay.textContent = '?';
            
            // åˆ‡æ¢æŒ‰é’®æ˜¾ç¤º
            nextBtn.classList.remove('show');
            drawBtn.style.display = 'inline-block';
            drawBtn.disabled = false;
            drawHint.textContent = 'ç‚¹å‡»æŒ‰é’®ï¼Œæ­æ™“ä½ çš„ç¤¼ç‰©æ­å­ï¼';
            
            // ä¸‹ä¸€ä¸ªäºº
            currentDrawerIndex++;
            updateCurrentDrawer();
            
            // é‡æ–°åˆ›å»ºæ°”æ³¡ï¼ˆä¼šè‡ªåŠ¨å¸¦æœ‰åŠ¨ç”»ï¼‰
            createBubbles();
        }

        // é‡æ–°å¼€å§‹æŠ½ç­¾ï¼ˆå›åˆ°ç¬¬ä¸€ä¸ªäººï¼‰
        function restartDraw() {
            if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰æŠ½ç­¾ç»“æœå°†è¢«æ¸…ç©ºã€‚')) {
                return;
            }
            
            // é‡ç½®æ•°æ®
            availableTargets = shuffleArray([...participants]);
            currentDrawerIndex = 0;
            results = [];
            isDrawing = false;
            
            // é‡æ–°ç”Ÿæˆå®Œç¾åŒ¹é…
            perfectMatching = generatePerfectMatching(participants);
            
            // é‡ç½®UI
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            const drawBtn = document.getElementById('drawBtn');
            const nextBtn = document.getElementById('nextBtn');
            const drawHint = document.getElementById('drawHint');
            
            giftBox.classList.remove('open', 'shake');
            nameDisplay.classList.remove('show', 'revealed');
            nameDisplay.textContent = '?';
            
            drawBtn.style.display = 'inline-block';
            drawBtn.disabled = false;
            nextBtn.classList.remove('show');
            drawHint.textContent = 'ç‚¹å‡»æŒ‰é’®ï¼Œæ­æ™“ä½ çš„ç¤¼ç‰©æ­å­ï¼';
            
            // æ¸…ç©ºç»“æœåˆ—è¡¨
            document.getElementById('resultsList').innerHTML = '';
            
            // æ›´æ–°å½“å‰æŠ½ç­¾äºº
            updateCurrentDrawer();
            
            // é‡æ–°åˆ›å»ºæ°”æ³¡
            createBubbles();
        }

        // æ›´æ–°ç»“æœåˆ—è¡¨
        function updateResultsList() {
            const list = document.getElementById('resultsList');
            const lastResult = results[results.length - 1];
            
            const item = document.createElement('div');
            item.className = 'result-item';
            item.innerHTML = `
                <span class="result-giver">${lastResult.giver}</span>
                <span class="result-arrow">å°†æ”¶åˆ°æ¥è‡ª</span>
                <span class="result-receiver">${lastResult.receiver}</span>
                <span class="result-arrow">çš„æƒŠå–œç¤¼ç‰©</span>
            `;
            list.appendChild(item);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            list.scrollTop = list.scrollHeight;
        }

        // æ˜¾ç¤ºå®Œæˆåº†ç¥
        function showCelebration() {
            document.getElementById('drawSection').style.display = 'none';
            document.getElementById('celebration').classList.add('show');
            
            // å¤šæ”¾å‡ æ¬¡çƒŸèŠ±
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createFirework(), i * 300);
            }
        }

        // ==================== ç‰¹æ•ˆ ====================

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFirework() {
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#ff9f43', '#a55eea', '#26de81'];
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = (Math.random() * 80 + 10) + '%';
            firework.style.top = (Math.random() * 50 + 20) + '%';
            document.body.appendChild(firework);

            // åˆ›å»ºç²’å­
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (i / 20) * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                
                firework.appendChild(particle);
            }

            // ç§»é™¤çƒŸèŠ±
            setTimeout(() => {
                firework.remove();
            }, 1000);
        }

        // æ˜¾ç¤ºå¯çˆ±çš„"æŠ½åˆ°è‡ªå·±"æç¤ºï¼ˆå¤‡ç”¨ï¼Œå½“çœŸçš„åªå‰©è‡ªå·±æ—¶è§¦å‘ï¼‰
        function showSelfDrawToast(callback) {
            // åˆ›å»ºé®ç½©
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            document.body.appendChild(overlay);
            
            // åˆ›å»ºæç¤ºå¼¹çª—
            const toast = document.createElement('div');
            toast.className = 'cute-toast';
            toast.innerHTML = `
                <div class="cute-toast-emoji">ğŸ˜…ğŸ</div>
                <div class="cute-toast-text">
                    å“å‘€ï¼å·®ç‚¹æŠ½åˆ°è‡ªå·±å•¦ï½<br>
                    ç³»ç»Ÿå·²è‡ªåŠ¨å¸®ä½ æ¢ä¸ªæ­å­ï¼Œé‡æ–°å¼€å¯ç¼˜åˆ†ï¼
                </div>
                <button class="cute-toast-btn" onclick="closeSelfDrawToast(this)">âœ¨ å¥½çš„ï¼Œç»§ç»­æŠ½ç­¾</button>
            `;
            document.body.appendChild(toast);
            
            // ä¿å­˜å›è°ƒ
            toast.dataset.callback = 'true';
            window.selfDrawCallback = callback;
        }

        // å…³é—­æç¤ºå¼¹çª—
        function closeSelfDrawToast(btn) {
            const toast = btn.parentElement;
            const overlay = document.querySelector('.overlay');
            
            toast.classList.add('hide');
            
            setTimeout(() => {
                toast.remove();
                if (overlay) overlay.remove();
                
                // æ‰§è¡Œå›è°ƒ
                if (window.selfDrawCallback) {
                    window.selfDrawCallback();
                    window.selfDrawCallback = null;
                }
            }, 300);
        }

        // é‡ç½®æ‰€æœ‰
        function resetAll() {
            participants = [];
            availableTargets = [];
            currentDrawerIndex = 0;
            results = [];
            isDrawing = false;

            // é‡ç½®UI
            document.getElementById('nameInput').value = '';
            document.getElementById('resultsList').innerHTML = '';
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('drawSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('celebration').classList.remove('show');
            document.getElementById('drawBtn').disabled = false;
            document.getElementById('drawBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('drawHint').textContent = 'ç‚¹å‡»æŒ‰é’®ï¼Œæ­æ™“ä½ çš„ç¤¼ç‰©æ­å­ï¼';
            document.getElementById('bubbleArea').innerHTML = '';

            // é‡ç½®ç¤¼ç›’
            const giftBox = document.getElementById('giftBox');
            const nameDisplay = document.getElementById('nameDisplay');
            giftBox.classList.remove('open', 'shake');
            nameDisplay.classList.remove('show', 'revealed');
            nameDisplay.textContent = '?';
        }
    </script>
</body>
</html>
